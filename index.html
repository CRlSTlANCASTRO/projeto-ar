<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR - Soma com 3 Marcadores</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.1.8/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      .debug-info {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        z-index: 1000;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <div class="debug-info" id="debug">Nenhum marcador detectado</div>

    <a-scene
      embedded
      arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false;"
      vr-mode-ui="enabled: false"
    >
      <!-- Iluminação -->
      <a-light type="ambient" intensity="0.8"></a-light>
      <a-light type="directional" intensity="0.5" position="-1 1 2"></a-light>

      <!-- Marcador Número 1 -->
      <a-marker id="marker1" type="pattern" url="markers/pattern-marker-1.patt" emit-events="true" data-value="1">
        <a-text value="1" position="0 0.5 0" scale="3 3 3" color="red"></a-text>
      </a-marker>

      <!-- Marcador Sinal de Adição -->
      <a-marker id="markerPlus" type="pattern" url="markers/pattern-marker-plus.patt" emit-events="true">
        <a-text value="+" position="0 0.5 0" scale="3 3 3" color="yellow"></a-text>
      </a-marker>

      <!-- Marcador Número 2 -->
      <a-marker id="marker2" type="pattern" url="markers/pattern-marker-2.patt" emit-events="true" data-value="2">
        <a-text value="2" position="0 0.5 0" scale="3 3 3" color="blue"></a-text>
      </a-marker>

      <!-- Resultado exibido no centro da cena -->
      <a-entity id="resultText" position="0 1 0">
        <a-text value="" color="green" scale="4 4 4" align="center"></a-text>
      </a-entity>

      <!-- Câmera -->
      <a-entity camera></a-entity>
    </a-scene>

    <!-- Script para Depuração e Operação -->
    <script>
      const debugDiv = document.getElementById('debug');
      const resultText = document.querySelector('#resultText a-text');
      
      // Estado dos marcadores
      const markerStates = {
        marker1: false,
        markerPlus: false,
        marker2: false
      };
      
      // Configurar eventos para cada marcador
      function setupMarkerEvents(markerId) {
        const marker = document.querySelector(`#${markerId}`);
        if (marker) {
          marker.addEventListener('markerFound', () => {
            markerStates[markerId] = true;
            updateResult();
            updateDebugText();
          });
          marker.addEventListener('markerLost', () => {
            markerStates[markerId] = false;
            updateResult();
            updateDebugText();
          });
        }
      }
      
      // Inicializar eventos para todos os marcadores
      Object.keys(markerStates).forEach(setupMarkerEvents);

      function updateResult() {
        if (markerStates.marker1 && markerStates.markerPlus && markerStates.marker2) {
          const val1 = parseInt(document.querySelector('#marker1').getAttribute('data-value'));
          const val2 = parseInt(document.querySelector('#marker2').getAttribute('data-value'));
          const result = val1 + val2;
          resultText.setAttribute('value', `Resultado: ${result}`);
        } else {
          resultText.setAttribute('value', '');
        }
      }

      function updateDebugText() {
        const visibles = Object.keys(markerStates).filter(id => markerStates[id]);
        debugDiv.textContent = visibles.length
          ? `Detectados: ${visibles.join(', ')}`
          : 'Nenhum marcador detectado';
      }
    </script>
  </body>
</html>